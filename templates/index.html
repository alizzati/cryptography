<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skripsi Crypto - Hill Cipher & Rabin</title>
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üîê Analisis Efisiensi Pengamanan Citra</h1>
        <p>Implementasi Algoritma Hill Cipher & Kunci Publik Rabin-p</p>
    </div>

    <div class="main-content">
        
        <div class="card">
            <div class="card-title">üîí PROSES ENKRIPSI (PENGIRIM)</div>
            <form action="/" method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label>1. Upload Gambar Asli (JPG/PNG)</label>
                    <input type="file" name="image" required>
                </div>
                <input type="hidden" name="action" value="encrypt">
                <button type="submit" class="btn btn-encrypt">Generate Kunci & Enkripsi</button>
            </form>

            {% if mode == 'encrypt' %}
            <div class="result-area">
                <h3>Hasil Enkripsi (Cipher Image)</h3>
                <img src="data:image/png;base64,{{ image_data }}" alt="Encrypted">
                
                <div class="key-box" style="background: #f0f9ff; color: #000; border: 1px solid #bae6fd;">
                    <strong>üìä HASIL ANALISIS (Data Paper):</strong>
                    <ul style="margin: 5px 0 10px 20px;">
                        <li><strong>Entropy Asli:</strong> {{ entropy_orig }} (Target: ~7.xx)</li>
                        <li><strong>Entropy Enkripsi:</strong> {{ entropy_enc }} (Target: mendekati 8.0)</li>
                        <li><strong>Korelasi (NPCR):</strong> {{ correlation }} (Target: mendekati 0)</li>
                        <li><strong>PSNR:</strong> {{ psnr }} dB</li>
                        <li><strong>Waktu Komputasi:</strong> {{ time_taken }} detik</li>
                    </ul>
                </div>

                <div class="key-box">
                    <strong>üì¶ INFO KUNCI (Untuk Disimpan):</strong><br>
                    Matriks Hill (Kunci Simetris):<br>
                    {{ hill_key }}<br><br>
                    Rabin Public Key (N): {{ rabin_n }}<br>
                    Rabin Private Key (p, q): {{ rabin_p }}, {{ rabin_q }}
                </div>
                <br>
                <small>Klik kanan gambar -> Save As untuk menyimpan.</small>
            </div>
            {% endif %}
        </div>

        <div class="card">
            <div class="card-title">üîì PROSES DEKRIPSI (PENERIMA)</div>
            <form action="/" method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label>1. Upload Gambar Terenkripsi (Cipher)</label>
                    <input type="file" name="image" required>
                </div>
                
                <div class="form-group">
                    <label>2. Masukkan Kunci Matriks Hill (2x2)</label>
                    <div class="input-grid">
                        <input type="number" name="k00" placeholder="00" required>
                        <input type="number" name="k01" placeholder="01" required>
                        <input type="number" name="k10" placeholder="10" required>
                        <input type="number" name="k11" placeholder="11" required>
                    </div>
                </div>

                <input type="hidden" name="action" value="decrypt">
                <button type="submit" class="btn btn-decrypt">Dekripsi Gambar</button>
            </form>

            {% if mode == 'decrypt' %}
            <div class="result-area">
                <h3>Hasil Dekripsi (Plain Image)</h3>
                <img src="data:image/png;base64,{{ image_data }}" alt="Decrypted">
                <p style="color: green; font-weight: bold; margin-top: 10px;">‚úÖ Gambar Berhasil Kembali!</p>
            </div>
            {% endif %}
            
            {% if error %}
            <div class="result-area" style="background: #ffebee; color: red;">
                <strong>Error:</strong> {{ error }}
            </div>
            {% endif %}
        </div>

    </div>
</div>

</body>
</html>