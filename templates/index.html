<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skripsi Crypto - Hill Cipher & Rabin</title>
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üîê Analisis Efisiensi Pengamanan Citra</h1>
        <p>Implementasi Algoritma Hill Cipher & Kunci Publik Rabin-p</p>
    </div>

    <div class="main-content">
        
        <div class="card">
            <div class="card-title">üîí PROSES ENKRIPSI (PENGIRIM)</div>
            <form action="/" method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label>1. Upload Gambar Asli (JPG/PNG)</label>
                    <input type="file" name="image" required>
                </div>
                <input type="hidden" name="action" value="encrypt">
                <button type="submit" class="btn btn-encrypt">Generate Kunci & Enkripsi</button>
            </form>

            {% if mode == 'encrypt' %}
            <div class="result-area">
                <h3>Hasil Enkripsi (Cipher Image)</h3>
                <img src="data:image/png;base64,{{ image_data }}" alt="Encrypted">
                
                <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 300px;">
                        <img src="data:image/png;base64,{{ hist_orig }}" style="width: 100%; border: 1px solid #ddd;">
                        <p><small>Histogram Asli (Pola Terlihat)</small></p>
                    </div>
                    <div style="flex: 1; min-width: 300px;">
                        <img src="data:image/png;base64,{{ hist_enc }}" style="width: 100%; border: 1px solid #ddd;">
                        <p><small>Histogram Enkripsi (Rata/Uniform)</small></p>
                    </div>
                </div>

                <div class="key-box" style="background: #f0f9ff; color: #000; border: 1px solid #bae6fd; margin-top: 20px;">
                    <strong>DATA ANALISIS:</strong>
                    <table style="width: 100%; margin-top: 10px; font-size: 0.9em;">
                        <tr><td>Entropy Asli</td><td>: {{ entropy_orig }}</td></tr>
                        <tr><td>Entropy Cipher</td><td>: <strong>{{ entropy_enc }}</strong> (Target > 7.99)</td></tr>
                        <tr><td>Korelasi</td><td>: {{ correlation }} (Target ~0)</td></tr>
                        <tr><td>NPCR</td><td>: {{ npcr }} % (Target > 99.6%)</td></tr>
                        <tr><td>UACI</td><td>: {{ uaci }} % (Target ~33.4%)</td></tr>
                        <tr><td>PSNR</td><td>: {{ psnr }} dB</td></tr>
                        <tr><td>Waktu</td><td>: {{ time_taken }} detik</td></tr>
                    </table>
                </div>

                <div class="key-box">
                    <strong>INFO KUNCI:</strong><br>
                    Matriks Hill: {{ hill_key }}<br>
                    Rabin (N): {{ rabin_n }}
                </div>
            </div>
            {% endif %}
        </div>

        <div class="card">
            <div class="card-title">üîì PROSES DEKRIPSI (PENERIMA)</div>
            <form action="/" method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label>1. Upload Gambar Terenkripsi (Cipher) *Wajib</label>
                    <input type="file" name="image" required>
                </div>
                
                <!-- <div class="form-group" style="background: #eef; padding: 10px; border-radius: 5px;">
                    <label>2. Upload Gambar Asli (Opsional)</label>
                    <input type="file" name="original_image_verify">
                    <small style="color: #666;">*Upload gambar asli jika ingin melihat nilai MSE & PSNR.</small>
                </div> -->
                
                <div class="form-group">
                    <label>2. Masukkan Kunci Matriks Hill (2x2)</label>
                    <div class="input-grid">
                        <input type="number" name="k00" placeholder="00" required>
                        <input type="number" name="k01" placeholder="01" required>
                        <input type="number" name="k10" placeholder="10" required>
                        <input type="number" name="k11" placeholder="11" required>
                    </div>
                </div>

                <input type="hidden" name="action" value="decrypt">
                <button type="submit" class="btn btn-decrypt">Dekripsi Gambar</button>
            </form>

            {% if mode == 'decrypt' %}
            <div class="result-area">
                <h3>Hasil Dekripsi (Plain Image)</h3>
                <img src="data:image/png;base64,{{ image_data }}" alt="Decrypted">
                
                <!-- <div style="margin-top: 15px;">
                    <img src="data:image/png;base64,{{ hist_dec }}" style="width: 100%; border: 1px solid #ddd;">
                    <p><small>Histogram Hasil Dekripsi</small></p>
                </div> -->

                <!-- <div class="key-box" style="background: #f0f9ff; color: #000; border: 1px solid #bae6fd; margin-top: 20px;">
                    <strong>üìä VALIDASI DEKRIPSI:</strong>
                    <table style="width: 100%; margin-top: 10px; font-size: 0.9em;">
                        <tr><td>Waktu Dekripsi</td><td>: {{ time_taken }} detik</td></tr>
                        <tr><td>Entropy Hasil</td><td>: {{ entropy_dec }}</td></tr>
                        
                        {% if analysis %}
                        <tr><td colspan="2"><hr><strong>Perbandingan dengan Asli:</strong></td></tr>
                        <tr><td>MSE (Error)</td><td>: <strong>{{ analysis.mse }}</strong> (Target: 0.0)</td></tr>
                        <tr><td>PSNR (Kualitas)</td><td>: {{ analysis.psnr }} dB (Target: >50 / 100)</td></tr>
                        <tr><td>Korelasi</td><td>: {{ analysis.correlation }} (Target: 1.0)</td></tr>
                        {% else %}
                        <tr><td colspan="2"><hr><em>*Upload gambar asli untuk lihat MSE & PSNR</em></td></tr>
                        {% endif %}
                    </table>
                </div> -->

                <!-- <p style="color: green; font-weight: bold; margin-top: 10px;">‚úÖ Gambar Berhasil Kembali!</p> -->
            </div>
            {% endif %}
            
            {% if error %}
            <div class="result-area" style="background: #ffebee; color: red;">
                <strong>Error:</strong> {{ error }}
            </div>
            {% endif %}
        </div>
    </div>
</div>

</body>
</html>